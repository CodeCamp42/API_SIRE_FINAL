generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id            Int            @id @default(autoincrement())
  nombre        String
  rol           String
  credencialSOL CredencialSOL?
  facturas      Factura[]
}

model CredencialSOL {
  ruc        String  @id
  usuarioSOL String
  claveSOL   String
  estado     String
  usuarioId  Int     @unique
  usuario    Usuario @relation(fields: [usuarioId], references: [id])
}

model Proveedor {
  rucProveedor String    @id
  razonSocial  String
  facturas     Factura[]
}

model Factura {
  idFactura              Int                     @id @default(autoincrement())
  numeroComprobante      String                  @unique
  fechaEmision           DateTime
  estado                 EstadoFactura
  detallesObtenidos      Boolean                 @default(false)
  usuarioId              Int
  proveedorRuc           String
  costoTotal             Decimal                 @db.Decimal(12, 2)
  igv                    Decimal                 @db.Decimal(12, 2)
  importeTotal           Decimal                 @db.Decimal(12, 2)
  moneda                 String                  @default("PEN")
  numero                 String
  serie                  String
  comprobanteElectronico ComprobanteElectronico?
  detalles               DetalleFactura[]
  proveedor              Proveedor               @relation(fields: [proveedorRuc], references: [rucProveedor])
  usuario                Usuario                 @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId, estado])
  @@index([detallesObtenidos])
}

model DetalleFactura {
  id            Int     @id @default(autoincrement())
  descripcion   String
  cantidad      Decimal @db.Decimal(12, 3)
  costoUnitario Decimal @db.Decimal(12, 2)
  unidadMedida  String?
  facturaId     Int
  factura       Factura @relation(fields: [facturaId], references: [idFactura], onDelete: Cascade)
}

model ComprobanteElectronico {
  idComprobante  Int      @id @default(autoincrement())
  xml            String
  cdr            String
  fechaRecepcion DateTime
  estadoSunat    String
  facturaId      Int      @unique
  factura        Factura  @relation(fields: [facturaId], references: [idFactura])
}

enum EstadoFactura {
  CONSULTADO
  CON_DETALLE
  REGISTRADO
  CONTABILIZADO
}
